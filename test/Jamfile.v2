# Copyright (c) 2018-2019 Emil Dotchevski
# Copyright (c) 2018-2019 Second Spectrum, Inc.

# Distributed under the Boost Software License, Version 1.0. (See accompanying
# file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

import testing ;

project
    : requirements
        <toolset>gcc:<cxxflags>"-std=c++11 -Wno-delete-non-virtual-dtor -Wno-parentheses"
        <toolset>gcc:<linkflags>"-pthread"
        <toolset>clang:<cxxflags>"-Wno-dangling-else"
        <toolset>darwin:<cxxflags>"-std=c++11 -Wno-unused-variable -Wno-delete-non-virtual-dtor -Wno-non-virtual-dtor -Wno-dangling-else"
		<toolset>msvc:<cxxflags>"-wd 4267 -wd 4996 -wd 4244"
		<include>../../..
    ;

compile _hpp_all_test.cpp ;
compile _hpp_capture_test.cpp ;
compile _hpp_common_test.cpp ;
compile _hpp_context_test.cpp ;
compile _hpp_error_test.cpp ;
compile _hpp_exception_test.cpp ;
compile _hpp_handle_error_test.cpp ;
compile _hpp_handle_exception_test.cpp ;
compile _hpp_preload_test.cpp ;
compile _hpp_result_test.cpp ;

run accumulate_basic_test.cpp ;
run accumulate_nested_error_exception_test.cpp ;
run accumulate_nested_error_result_test.cpp ;
run accumulate_nested_new_error_exception_test.cpp ;
run accumulate_nested_new_error_result_test.cpp ;
run accumulate_nested_success_exception_test.cpp ;
run accumulate_nested_success_result_test.cpp ;
run capture_exception_async_test.cpp ;
run capture_exception_result_async_test.cpp ;
run capture_exception_state_test.cpp ;
run capture_exception_unload_test.cpp ;
run capture_result_async_test.cpp ;
run capture_result_state_test.cpp ;
run capture_result_unload_test.cpp ;
run continuation_test.cpp ;
run ctx_remote_handle_all_test.cpp ;
run ctx_remote_handle_exception_test.cpp ;
run ctx_remote_handle_some_test.cpp ;
run defer_basic_test.cpp ;
run defer_nested_error_exception_test.cpp ;
run defer_nested_error_result_test.cpp ;
run defer_nested_new_error_exception_test.cpp ;
run defer_nested_new_error_result_test.cpp ;
run defer_nested_success_exception_test.cpp ;
run defer_nested_success_result_test.cpp ;
run diagnostic_info_test.cpp ;
run error_code_test.cpp ;
run exception_test.cpp ;
run exception_to_result_test.cpp ;
run function_traits_test.cpp ;
run handle_all_other_result_test.cpp ;
run handle_all_test.cpp ;
run handle_basic_test.cpp ;
run handle_some_other_result_test.cpp ;
run handle_some_test.cpp ;
run is_error_type_test.cpp ;
run multiple_errors_test.cpp ;
run optional_test.cpp ;
run preload_basic_test.cpp ;
run preload_nested_error_exception_test.cpp ;
run preload_nested_error_result_test.cpp ;
run preload_nested_new_error_exception_test.cpp ;
run preload_nested_new_error_result_test.cpp ;
run preload_nested_success_exception_test.cpp ;
run preload_nested_success_result_test.cpp ;
run print_test.cpp ;
run result_bad_result_test.cpp ;
run result_load_accumulate_test.cpp ;
run result_state_test.cpp ;
run context_deduction_test.cpp ;
run try_catch_error_id_test.cpp ;
run try_catch_test.cpp ;
run try_exception_and_result_test.cpp ;

compile-fail is_error_type_fail_test.cpp ;
compile-fail result_fail_test.cpp ;

exe capture_in_exception : ../examples/capture_in_exception.cpp : <threading>multi ;
exe capture_in_result : ../examples/capture_in_result.cpp : <threading>multi ;
exe error_log : ../examples/error_log.cpp ;
exe error_trace : ../examples/error_trace.cpp ;
exe exception_to_result : ../examples/exception_to_result.cpp ;
#exe lua_callback_result : ../examples/exception_to_result.cpp ;
#exe lua_callback_eh : ../examples/lua_callback_eh.cpp ;
exe print_file_eh : ../examples/print_file_eh.cpp ;
exe print_file_result : ../examples/print_file_result.cpp ;
exe print_half : ../examples/print_half.cpp ;
